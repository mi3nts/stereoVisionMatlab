% # ***************************************************************************
% #   Stereo Vision - Thermal 
% #   ---------------------------------
% #   Written by: Lakitha Omal Harindha Wijeratne
% #   - for -
% #   Mints: Multi-scale Integrated Sensing and Simulation
% #   ---------------------------------
% #   Date: January 23rd, 2020
% #   ---------------------------------
% #   This module is written for generic implimentation of MINTS projects
% #   --------------------------------------------------------------------------
% #   https://github.com/mi3nts
% #   http://utdmints.info/
% #  ***************************************************************************

%% Chapter_01 : Generating Left and Right Camera Calibration Parametors

% For the visual camera calibration utdset0 is used

% Define images to process
imageFileNames1 = {...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_28_41_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_28_55_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_29_16_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_29_30_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_29_37_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_29_44_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_29_51_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_29_58_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_30_05_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_30_12_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_55_49_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_55_56_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_56_03_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_56_10_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_56_17_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_56_24_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_56_31_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_56_38_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_56_45_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_56_52_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_56_59_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_57_06_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_57_13_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_13_57_20_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_14_34_34_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_14_34_42_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_14_34_49_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_14_34_56_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_14_35_03_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_14_35_10_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_14_35_17_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_14_35_24_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_14_35_31_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_14_35_38_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_14_35_59_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_14_36_06_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_14_36_13_left.jpg',...
    '../threeWayImageDataSets/utdSet0/left/2019_10_24_14_36_20_left.jpg',...
    };


imageFileNames2 = {...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_28_41_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_28_55_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_29_16_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_29_30_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_29_37_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_29_44_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_29_51_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_29_58_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_30_05_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_30_12_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_55_49_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_55_56_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_56_03_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_56_10_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_56_17_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_56_24_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_56_31_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_56_38_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_56_45_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_56_52_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_56_59_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_57_06_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_57_13_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_13_57_20_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_14_34_34_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_14_34_42_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_14_34_49_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_14_34_56_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_14_35_03_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_14_35_10_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_14_35_17_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_14_35_24_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_14_35_31_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_14_35_38_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_14_35_59_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_14_36_06_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_14_36_13_right.jpg',...
    '../threeWayImageDataSets/utdSet0/right/2019_10_24_14_36_20_right.jpg',...
    };

% Detect checkerboards in images
[imagePoints, boardSize, imagesUsed] = detectCheckerboardPoints(imageFileNames1, imageFileNames2);

% Generate world coordinates of the checkerboard keypoints
squareSize = 35;  % in units of 'millimeters'
worldPoints = generateCheckerboardPoints(boardSize, squareSize);

% Read one of the images from the first stereo pair
I1 = imread(imageFileNames1{1});
[mrows, ncols, ~] = size(I1);

% Calibrate the camera
[stereoParamsLeftAndRight, pairsUsed, estimationErrors] = estimateCameraParameters(imagePoints, worldPoints, ...
    'EstimateSkew', false, 'EstimateTangentialDistortion', false, ...
    'NumRadialDistortionCoefficients', 2, 'WorldUnits', 'millimeters', ...
    'InitialIntrinsicMatrix', [], 'InitialRadialDistortion', [], ...
    'ImageSize', [mrows, ncols]);

% View reprojection errors
h1=figure; showReprojectionErrors(stereoParamsLeftAndRight);

% Visualize pattern locations
h2=figure; showExtrinsics(stereoParamsLeftAndRight, 'CameraCentric');

% Display parameter estimation errors
displayErrors(estimationErrors, stereoParamsLeftAndRight);

% You can use the calibration data to rectify stereo images.
I2 = imread(imageFileNames2{1});
[J1, J2] = rectifyStereoImages(I1, I2, stereoParamsLeftAndRight);

% Saving Data Products 
save('../dataProducts/leftAndRightCalibrationNov06th')
save('../dataProducts/leftAndRightParametorsNov06th','stereoParamsLeftAndRight','transformParametors')
close all

